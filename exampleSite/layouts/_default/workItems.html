{{ define "main" }}
{{ $jsonData := getJSON "data/workItems.json" }}
{{ $jsonDataAlpine := readFile "data/workItems.json" }}
<svg  xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="d-none" viewBox="0 0 16 16">
  <symbol fill="currentColor" id="arrow-up" viewBox="0 0 448 512">
    <path d="M6.1 261.9L25.9 281.7c4.7 4.7 12.3 4.7 17 0L198 126.6V468c0 6.6 5.4 12 12 12h28c6.6 0 12-5.4 12-12V126.6l155.1 155.1c4.7 4.7 12.3 4.7 17 0l19.8-19.8c4.7-4.7 4.7-12.3 0-17L232.5 35.5c-4.7-4.7-12.3-4.7-17 0L6.1 244.9c-4.7 4.7-4.7 12.3 0 17z"/>
  </symbol>
  <symbol fill="currentColor" id="arrows-v" viewBox="0 0 256 512">
    <path d="M160 406.2V105.8l43.7 46.2c9.3 9.8 24.8 10 34.4 .5l10.8-10.8c9.4-9.4 9.4-24.6 0-33.9L150.6 9.4c-12.5-12.5-32.8-12.5-45.3 0L7 107.7c-9.4 9.4-9.4 24.6 0 33.9l10.8 10.8c9.6 9.6 25.1 9.3 34.4-.5L96 105.8v300.4l-43.7-46.2c-9.3-9.8-24.8-10-34.4-.5l-10.8 10.8c-9.4 9.4-9.4 24.6 0 33.9l98.3 98.3c12.5 12.5 32.8 12.5 45.3 0l98.3-98.3c9.4-9.4 9.4-24.6 0-33.9l-10.8-10.8c-9.6-9.6-25.1-9.3-34.4 .5L160 406.2z"/>
  </symbol>
  <symbol fill="currentColor" id="bookmark" viewBox="0 0 384 512">
    <path d="M0 48C0 21.5 21.5 0 48 0l0 48V441.4l130.1-92.9c8.3-6 19.6-6 27.9 0L336 441.4V48H48V0H336c26.5 0 48 21.5 48 48V488c0 9-5 17.2-13 21.3s-17.6 3.4-24.9-1.8L192 397.5 37.9 507.5c-7.3 5.2-16.9 5.9-24.9 1.8S0 497 0 488V48z"/>
  </symbol>
  <symbol fill="currentColor" id="home" viewBox="0 0 576 512">
    <path d="M272.5 5.7c9-7.6 22.1-7.6 31.1 0l264 224c10.1 8.6 11.4 23.7 2.8 33.8s-23.7 11.3-33.8 2.8L512 245.5V432c0 44.2-35.8 80-80 80H144c-44.2 0-80-35.8-80-80V245.5L39.5 266.3c-10.1 8.6-25.3 7.3-33.8-2.8s-7.3-25.3 2.8-33.8l264-224zM288 55.5L112 204.8V432c0 17.7 14.3 32 32 32h48V312c0-22.1 17.9-40 40-40H344c22.1 0 40 17.9 40 40V464h48c17.7 0 32-14.3 32-32V204.8L288 55.5zM240 464h96V320H240V464z"/>
  </symbol>
  <symbol fill="currentColor" id="project" viewBox="0 0 576 512">
    <path d="M136 80c4.4 0 8 3.6 8 8v80c0 4.4-3.6 8-8 8H56c-4.4 0-8-3.6-8-8V88c0-4.4 3.6-8 8-8h80zM56 32C25.1 32 0 57.1 0 88v80c0 30.9 25.1 56 56 56h80c5.6 0 11.1-.8 16.2-2.4l75.9 101.2c-2.7 6.5-4.1 13.7-4.1 21.2v80c0 30.9 25.1 56 56 56h80c30.9 0 56-25.1 56-56V344c0-30.9-25.1-56-56-56H280c-5.6 0-11.1 .8-16.2 2.4L187.9 189.2c2.7-6.5 4.1-13.7 4.1-21.2V152H384v16c0 30.9 25.1 56 56 56h80c30.9 0 56-25.1 56-56V88c0-30.9-25.1-56-56-56H440c-30.9 0-56 25.1-56 56v16H192V88c0-30.9-25.1-56-56-56H56zM360 336c4.4 0 8 3.6 8 8v80c0 4.4-3.6 8-8 8H280c-4.4 0-8-3.6-8-8V344c0-4.4 3.6-8 8-8h80zM440 80h80c4.4 0 8 3.6 8 8v80c0 4.4-3.6 8-8 8H440c-4.4 0-8-3.6-8-8V88c0-4.4 3.6-8 8-8z"/>
  </symbol>
  <symbol fill="currentColor" id="comment-alt-medical" viewBox="0 0 512 512">
    <path d="M448 0H64A64 64 0 0 0 0 64v288a64 64 0 0 0 64 64h96v84a12 12 0 0 0 12.1 12 11.8 11.8 0 0 0 7.1-2.4L304 416h144a64 64 0 0 0 64-64V64a64 64 0 0 0 -64-64zm16 352a16 16 0 0 1 -16 16H288l-12.8 9.6L208 428v-60H64a16 16 0 0 1 -16-16V64a16 16 0 0 1 16-16h384a16 16 0 0 1 16 16zM344 176h-56v-56a8 8 0 0 0 -8-8h-48a8 8 0 0 0 -8 8v56h-56a8 8 0 0 0 -8 8v48a8 8 0 0 0 8 8h56v56a8 8 0 0 0 8 8h48a8 8 0 0 0 8-8v-56h56a8 8 0 0 0 8-8v-48a8 8 0 0 0 -8-8z"/>
  </symbol>
  <symbol fill="currentColor" id="comment-alt-edit" viewBox="0 0 512 512">
    <path d="M448 0H64C28.7 0 0 28.7 0 64v288c0 35.3 28.7 64 64 64h96v84c0 7.1 5.8 12 12 12 2.4 0 4.9-.7 7.1-2.4L304 416h144c35.3 0 64-28.7 64-64V64c0-35.3-28.7-64-64-64zm16 352c0 8.8-7.2 16-16 16H288l-12.8 9.6L208 428v-60H64c-8.8 0-16-7.2-16-16V64c0-8.8 7.2-16 16-16h384c8.8 0 16 7.2 16 16v288zM164.9 243.2l-4.8 42.8c-.6 5.7 4.2 10.6 10 10l42.8-4.8 85.5-85.5-48-48-85.5 85.5zm159.3-133.9c-7-7-18.4-7-25.4 0l-28.3 28.3 48 48 28.3-28.3c7-7 7-18.4 0-25.4l-22.6-22.6z"/>
  </symbol>
  <symbol fill="currentColor" id="bezier" viewBox="0 0 16 16">
      <path fill-rule="evenodd" d="M0 10.5A1.5 1.5 0 0 1 1.5 9h1A1.5 1.5 0 0 1 4 10.5v1A1.5 1.5 0 0 1 2.5 13h-1A1.5 1.5 0 0 1 0 11.5zm1.5-.5a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5zm10.5.5A1.5 1.5 0 0 1 13.5 9h1a1.5 1.5 0 0 1 1.5 1.5v1a1.5 1.5 0 0 1-1.5 1.5h-1a1.5 1.5 0 0 1-1.5-1.5zm1.5-.5a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5zM6 4.5A1.5 1.5 0 0 1 7.5 3h1A1.5 1.5 0 0 1 10 4.5v1A1.5 1.5 0 0 1 8.5 7h-1A1.5 1.5 0 0 1 6 5.5zM7.5 4a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5z"/>
      <path d="M6 4.5H1.866a1 1 0 1 0 0 1h2.668A6.52 6.52 0 0 0 1.814 9H2.5q.186 0 .358.043a5.52 5.52 0 0 1 3.185-3.185A1.5 1.5 0 0 1 6 5.5zm3.957 1.358A1.5 1.5 0 0 0 10 5.5v-1h4.134a1 1 0 1 1 0 1h-2.668a6.52 6.52 0 0 1 2.72 3.5H13.5q-.185 0-.358.043a5.52 5.52 0 0 0-3.185-3.185"/>
  </symbol>
</svg>


  <div
    class="container"
    x-data="{ data: {{ $jsonDataAlpine | safeJS }}
    , showCompactView: true,
    hasAnyCommentsSummaryTrue() {
      console.log('anyTrue:' +  this.data.some(item => item.options.commentsSummary === true))
      return this.data.some(item => item.options.commentsSummary === true) ;
    },
    hasAnyCommentsSummaryFalse() {
      console.log('anyFalse:' + this.data.some(item => item.options.commentsSummary === false))
      return this.data.some(item => item.options.commentsSummary === false);
    }, 
    setAllCommentSummaryTrue() {
    this.data.forEach(item => {
      item.options.commentsSummary = true;
      item.options.showCommentBox = false;
    });
  },
  setAllCommentSummaryFalse() {
    this.data.forEach(item => {
      item.options.commentsSummary = false;
    });
  },
  }">
  <!-- 
-->
    <div class="row">
      <div class="col-6 d-flex flex-column  pb-2">
        <div>
          <div class="btn-group">
            <button class="btn btn-sm btn-link" x-show="hasAnyCommentsSummaryFalse()" @click="setAllCommentSummaryTrue()">Compact All</button>
            <button class="btn btn-sm btn-link"  x-show="hasAnyCommentsSummaryTrue()" @click="setAllCommentSummaryFalse()">Expand All</button>
          </div>
        </div>
        <template
          x-for="(workItem, workItemIndex) in data"
          :key="`workItem-${workItemIndex}`">
          <div class="d-flex bg-white border-left border-right statusMarker"

            :class="[
            workItemIndex ? 'border-bottom' : 'border-top border-bottom rounded-top',
            workItem.Outcome ? `statusMarker-${workItem.Outcome.State}` : 'statusMarker-default'
            ]
            "
          >
          <side class="px-3 py-2 d-flex flex-column gap-sm">
            <!-- <span x-text="workItem.options.commentsSummary"></span> -->
            <div
              class="square d-flex badge badge-pill rounded-circle p-2 align-items-center justify-content-center"
              :class="workItem.Outcome ? `badge-${workItem.Outcome.State}-light` : 'badge-info-light'">
              <!-- <use x-bind:xlink:href="`#${workItem.Icon}`"></use> -->
              <!-- <use x-bind:xlink:href="`#${workItem.Icon}`"></use> -->
              <svg x-show="workItem.Icon === 'bookmark'" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-bezier" viewBox="0 0 16 16">
                  <use  xlink:href="#bookmark" />
              </svg>
              <svg x-show="workItem.Icon === 'home'" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-bezier" viewBox="0 0 16 16">
                <use  xlink:href="#home" />
              </svg>
              <svg x-show="workItem.Icon === 'project'" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-bezier" viewBox="0 0 16 16">
                <use  xlink:href="#project" />
              </svg>
            </div>

            <div class="d-flex flex-column">

              <button x-show="!workItem.Comment.length" type="button" @click="workItem.options.showCommentBox = !workItem.options.showCommentBox" class="btn btn-link square rounded-circle bg-light"
              data-toggle="tooltip"  title="Add Comments"
              >
                <svg x-show="!workItem.Comment.length" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-bezier" viewBox="0 0 16 16">
                  <use  xlink:href="#comment-alt-medical" />
                </svg>
                <svg x-show="workItem.Comment.length" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-bezier" viewBox="0 0 16 16">
                  <use  xlink:href="#comment-alt-edit" />
                </svg>
              </button>

              <div
                class="btn-group"
                role="group"
                aria-label="Button group with nested dropdown">
                <div class="btn-group" role="group" x-show="workItem.Comment.length"> 
                  <button
                    type="button"
                    class="btn btn-link square rounded-circle dropdown-toggle bg-light dropdown-toggle__noShevron"
                    data-toggle="dropdown"
                    aria-expanded="false"
                    
                    >
                    
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      width="16"
                      height="16"
                      fill="currentColor"
                      class="bi bi-three-dots"
                      viewBox="0 0 16 16">
                      <path
                        d="M3 9.5a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3m5 0a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3m5 0a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3" />
                    </svg>
                  </button>
                  <div class="dropdown-menu" >
                    <div class="d-flex flex-column">
                      <button
                      
                      @click="workItem.options.commentsSummary = !workItem.options.commentsSummary"
                      class="dropdown-item">
                        <span x-show="workItem.options.commentsSummary"> Expand this</span>
                        <span x-show="!workItem.options.commentsSummary"> Compact this</span>
                      </button>
                    </div>
                    
                    <button class="dropdown-item" x-show="hasAnyCommentsSummaryFalse()" @click="setAllCommentSummaryTrue()">Compact All</button>
                    <button class="dropdown-item"  x-show="hasAnyCommentsSummaryTrue()" @click="setAllCommentSummaryFalse()">Expand All</button>

                    <!-- <button class="dropdown-item" x-show="hasAnyCommentsSummaryTrue()" @click="setAllCommentSummaryFalse()">Compact All</button>
                    <button class="dropdown-item"  x-show="hasAnyCommentsSummaryFalse()" @click="setAllCommentSummaryFalse()">Expand All</button> -->
        
                  </div>
                </div>
              </div>
            </div>
          </side>
          <main class="flex-grow-1 d-flex flex-column gap-sm pb-2">
            <div
                class="d-flex justify-content-between align-items-start w-100 ">
                <div class="pt-2">
                  <strong x-text="workItem.Title"></strong>
                </div>
              </div>

              <!-- FIRST ROW -->
              <div
                class="row no-gutters">
                <div class="col-6">
                  <template x-if="workItem.ProcessStep">
                    <div class="d-flex flex-column">
                      <small class="text-muted"> Process Step </small>
                      <div>
                        <span
                          x-text="workItem.ProcessStep"
                          class="">
                        </span>
                      </div>
                    </div>
                  </template>
                </div>
                <div class="col-6">
                  <template x-if="workItem.Outcome">
                    <div class="d-flex flex-column">
                      <small class="text-muted"> Outcome </small>
                      <div>
                        <span
                          x-text="workItem.Outcome.Title"
                          class="badge lead"
                          :class="`badge-${workItem.Outcome.State || 'info'}-light`">
                        </span>
                      </div>
                    </div>
                  </template>
                  <template x-if="workItem.Created">
                    <div class="d-flex flex-column">
                      <small class="text-muted"> Created On </small>
                      <div>
                        <span x-text="workItem.Created"> </span>
                      </div>
                    </div>
                  </template>
                </div>
              </div>
              
              <template x-if=" workItem.Completed && workItem.By">
                <div
                  class="row no-gutters">
                  <template x-if="workItem.Completed">
                    <div class="col-6">
                      <div class="d-flex flex-column">
                        <small class="text-muted"> Completed on </small>
                        <div>
                          <span x-text="workItem.Completed"> </span>
                        </div>
                      </div>
                    </div>
                  </template>
                  <template x-if="workItem.By">
                    <div class="col-6">
                        <div class="d-flex flex-column">
                          <small class="text-muted"> Completed by </small>
                          <div>
                            <span x-text="workItem.By"> </span>
                          </div>
                        </div>
                      </div>
                  </template>
                </div>
              </template>

              <template x-if="workItem.Reasons ">
                <div
                  class="row no-gutters">
                  <div class="col-12">
                    <div class="d-flex flex-column">
                      <small class="text-muted"> Reasons </small>

                      <div class="d-flex gap-sm flex-wrap">
                        <template
                          x-for="(reason, reasonsIndex) in workItem.Reasons"
                          :key="`reason-${reasonsIndex}`">
                          <span x-text="reason" class=" badge badge-info-light badge-pill"></span>
                      </template>
                    </div>
                  </div>
                </div>
              </template>

              <template x-if="workItem.options.showCommentBox">
                <div class="d-flex flex-column w-100 pr-2 border-top">
                  <div class="form-group mb-2 w-100">
                    <label for="exampleFormControlTextarea1 " class="mb-2 mt-1">
                      <small>

                        <span x-show="workItem.Comment.length">Edit</span>  
                        <span x-show="!workItem.Comment.length">Add</span>  
                        comments
                      </small>
                    </label>
                    <textarea class="form-control w-100" id="exampleFormControlTextarea1" 
                    x-model="workItem.Comment"
                    rows="4"></textarea>
                  </div>
                  <div class="form-group mb-0 w-100 d-flex justify-content-between">
                    <div>
                      <button type="submit" @click="workItem.options.showCommentBox = !workItem.options.showCommentBox" class="btn btn-link bg-light">Cancel</button>
                    </div>
                    <div>

                      <button
                      @click="workItem.options.showCommentBox = !workItem.options.showCommentBox"
                      type="submit" class="btn btn-outline-primary">
                        <span x-show="workItem.Comment.length">Save</span>  
                      <span x-show="!workItem.Comment.length">Add</span>  
                       comment</button>
                    </div>
                  </div>
                  
                </div>

              </template>

              <template x-if="workItem.Comment.length ">
                <template x-if="!workItem.options.showCommentBox">
                  <div
                    class="row no-gutters">
                    <div class="col-12">
                      <div class="d-flex flex-column border-top">
                        <div class="d-flex justify-content-between align-items-center">
                          <small class="text-muted"> Comments
                            <!-- <span x-text="workItem.options.showCommentBox"></span>   -->
                            <!-- <span x-text="workItem.options.commentsSummary"></span>   -->
                          </small>
                          <div>
                            <div class="btn-group mr-2">

                              <button type="button" @click="workItem.options.showCommentBox = !workItem.options.showCommentBox" class="btn btn-sm btn-link "
                              
                              >
                                <svg x-show="!workItem.Comment.length" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-bezier" viewBox="0 0 16 16">
                                  <use  xlink:href="#comment-alt-medical" />
                                </svg>
                                <svg x-show="workItem.Comment.length" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-bezier" viewBox="0 0 16 16">
                                  <use  xlink:href="#comment-alt-edit" />
                                </svg>
                              </button>
                              <button
                                @click="workItem.options.commentsSummary = !workItem.options.commentsSummary"
                                class="btn btn-sm btn-link"
                                
                                >
                                  <svg x-show="workItem.options.commentsSummary" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-bezier" viewBox="0 0 16 16">
                                    <use  xlink:href="#arrows-v" />
                                  </svg>
                                  <svg  x-show="!workItem.options.commentsSummary" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-bezier" viewBox="0 0 16 16">
                                    <use  xlink:href="#arrow-up" />
                                  </svg>
                              </button>
  
                            </div>
                          </div>
                        </div>
                        <div class="d-flex gap flex-wrap mr-2 xborder xp-2 xrounded">

                          <span class=""
                          x-text="workItem.Comment"
                          :class="workItem.options.commentsSummary ? 'commentsHeighSummary' : 'commentsHeigh'"
                          >
                            <!-- <span ></span> -->
                          </span>
                        </div>
                      </div>
                    </div>
                  </div>
                </template>
              </template>
          </main>
        </div>
        </template>

      </div>
    </div>
  </div>
  
  
  <script>
    $(function () {
      // Enables popover
      $("[data-toggle=popover]").popover();
    });
  </script>
{{ end }}
